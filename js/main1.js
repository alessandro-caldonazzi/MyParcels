!function(t){"use strict";var h=Modernizr.cssanimations,d={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Modernizr.prefixed("animation")];function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function e(t,e){var i;this.el=t,this.options=n({},this.options),n(this.options,e),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.current_menu=0,this.menus.forEach(function(t,n){t.querySelectorAll(".menu__item").forEach(function(t,e){t.querySelector(".menu__link--current")&&(i=n)})}),i&&(this.current_menu=i),this._init()}e.prototype.options={breadcrumbsCtrl:!1,backCtrl:!0,itemsDelayInterval:60,direction:"r2l",onItemClick:function(t,e){return!1}},e.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var s=this,a=[];this.menus.forEach(function(t,r){var e={menuEl:t,menuItems:[].slice.call(t.querySelectorAll(".menu__item"))};s.menusArr.push(e),r===s.current_menu&&classie.add(t,"menu__level--current");t.getAttribute("data-menu");t.querySelectorAll(".menu__link").forEach(function(t,e){var n=t.getAttribute("data-submenu");if(n){var i={menu:n,name:t.innerHTML};a[r]||(a[r]=[]),a[r].push(i)}})}),this.menus.forEach(function(t,i){var r=t.getAttribute("data-menu");a.forEach(function(t,n){t.forEach(function(t,e){t.menu==r&&(s.menusArr[i].backIdx=n,s.menusArr[i].name=t.name)})})}),s.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),0!=s.menusArr[s.current_menu].backIdx&&0!=s.current_menu&&(this._crawlCrumbs(s.menusArr[s.current_menu].backIdx,s.menusArr),this.breadCrumbs=!0),0!=s.current_menu&&(this._addBreadcrumb(s.current_menu),this.breadCrumbs=!0)),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML='<span class="icon icon--arrow-left"></span>',this.el.insertBefore(this.backCtrl,this.el.firstChild)),this._initEvents()},e.prototype._initEvents=function(){for(var s=this,t=0,e=this.menusArr.length;t<e;++t)this.menusArr[t].menuItems.forEach(function(t,r){t.querySelector("a").addEventListener("click",function(t){var e=t.target.getAttribute("data-submenu"),n=t.target.innerHTML,i=s.el.querySelector('ul[data-menu="'+e+'"]');e&&i?(t.preventDefault(),s._openSubMenu(i,r,n)):(s.el.querySelector(".menu__link--current")&&classie.remove(s.el.querySelector(".menu__link--current"),"menu__link--current"),classie.add(t.target,"menu__link--current"),s.options.onItemClick(t,n))})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){s._back()})},e.prototype._openSubMenu=function(t,e,n){if(this.isAnimating)return!1;this.isAnimating=!0,this.menusArr[this.menus.indexOf(t)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(t)].name=n,this._menuOut(e),this._menuIn(t,e)},e.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var t=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(t),this.options.breadcrumbsCtrl&&this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild)},e.prototype._menuOut=function(n){var i=this,t=this.menusArr[this.current_menu].menuEl,r=void 0===n;this.menusArr[this.current_menu].menuItems.forEach(function(t,e){t.style.WebkitAnimationDelay=t.style.animationDelay=r?parseInt(e*i.options.itemsDelayInterval)+"ms":parseInt(Math.abs(n-e)*i.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?classie.add(t,r?"animate-outToRight":"animate-outToLeft"):classie.add(t,r?"animate-outToLeft":"animate-outToRight")},e.prototype._menuIn=function(s,a){var u=this,m=this.menusArr[this.current_menu].menuEl,o=void 0===a,c=this.menus.indexOf(s),t=this.menusArr[c],e=(s=t.menuEl,t.menuItems),l=e.length;e.forEach(function(t,e){var n,i,r;t.style.WebkitAnimationDelay=t.style.animationDelay=o?parseInt(e*u.options.itemsDelayInterval)+"ms":parseInt(Math.abs(a-e)*u.options.itemsDelayInterval)+"ms",e===(a<=l/2||o?l-1:0)&&(n=t,i=function(){"r2l"===u.options.direction?(classie.remove(m,o?"animate-outToRight":"animate-outToLeft"),classie.remove(s,o?"animate-inFromLeft":"animate-inFromRight")):(classie.remove(m,o?"animate-outToLeft":"animate-outToRight"),classie.remove(s,o?"animate-inFromRight":"animate-inFromLeft")),classie.remove(m,"menu__level--current"),classie.add(s,"menu__level--current"),u.current_menu=c,o?0===u.current_menu&&u.options.backCtrl&&classie.add(u.backCtrl,"menu__back--hidden"):(u.options.backCtrl&&classie.remove(u.backCtrl,"menu__back--hidden"),u._addBreadcrumb(c)),u.isAnimating=!1,s.focus()},r=function(t){if(h){if(t.target!=this)return;this.removeEventListener(d,r)}i&&"function"==typeof i&&i.call()},h?n.addEventListener(d,r):r())}),"r2l"===this.options.direction?classie.add(s,o?"animate-inFromLeft":"animate-inFromRight"):classie.add(s,o?"animate-inFromRight":"animate-inFromLeft")},e.prototype._addBreadcrumb=function(i){if(!this.options.breadcrumbsCtrl)return!1;var r=this;bc.addEventListener("click",function(t){if(t.preventDefault(),!bc.nextSibling||r.isAnimating)return!1;r.isAnimating=!0,r._menuOut();var e,n=r.menusArr[i].menuEl;for(r._menuIn(n);e=bc.nextSibling;)r.breadcrumbsCtrl.removeChild(e)})},e.prototype._crawlCrumbs=function(t,e){0!=e[t].backIdx&&this._crawlCrumbs(e[t].backIdx,e),this._addBreadcrumb(t)},t.MLMenu=e}(window);
