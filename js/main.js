!function(e){"use strict";var h=Modernizr.cssanimations,d={WebkitAnimation:"webkitAnimationEnd",OAnimation:"oAnimationEnd",msAnimation:"MSAnimationEnd",animation:"animationend"}[Modernizr.prefixed("animation")];function n(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function t(e,t){var i;this.el=e,this.options=n({},this.options),n(this.options,t),this.menus=[].slice.call(this.el.querySelectorAll(".menu__level")),this.current_menu=0,this.menus.forEach(function(e,n){e.querySelectorAll(".menu__item").forEach(function(e,t){e.querySelector(".menu__link--current")&&(i=n)})}),i&&(this.current_menu=i),this._init()}t.prototype.options={breadcrumbsCtrl:!0,initialBreadcrumb:"all",backCtrl:!0,itemsDelayInterval:60,direction:"r2l",onItemClick:function(e,t){return!1}},t.prototype._init=function(){this.menusArr=[],this.breadCrumbs=!1;var a=this,s=[];this.menus.forEach(function(e,r){var t={menuEl:e,menuItems:[].slice.call(e.querySelectorAll(".menu__item"))};a.menusArr.push(t),r===a.current_menu&&classie.add(e,"menu__level--current");e.getAttribute("data-menu");e.querySelectorAll(".menu__link").forEach(function(e,t){var n=e.getAttribute("data-submenu");if(n){var i={menu:n,name:e.innerHTML};s[r]||(s[r]=[]),s[r].push(i)}})}),this.menus.forEach(function(e,i){var r=e.getAttribute("data-menu");s.forEach(function(e,n){e.forEach(function(e,t){e.menu==r&&(a.menusArr[i].backIdx=n,a.menusArr[i].name=e.name)})})}),a.options.breadcrumbsCtrl&&(this.breadcrumbsCtrl=document.createElement("nav"),this.breadcrumbsCtrl.className="menu__breadcrumbs",this.breadcrumbsCtrl.setAttribute("aria-label","You are here"),this.el.insertBefore(this.breadcrumbsCtrl,this.el.firstChild),this._addBreadcrumb(0),0!=a.menusArr[a.current_menu].backIdx&&0!=a.current_menu&&(this._crawlCrumbs(a.menusArr[a.current_menu].backIdx,a.menusArr),this.breadCrumbs=!0),0!=a.current_menu&&(this._addBreadcrumb(a.current_menu),this.breadCrumbs=!0)),this.options.backCtrl&&(this.backCtrl=document.createElement("button"),this.breadCrumbs?this.backCtrl.className="menu__back":this.backCtrl.className="menu__back menu__back--hidden",this.backCtrl.setAttribute("aria-label","Go back"),this.backCtrl.innerHTML='<span class="icon icon--arrow-left"></span>',this.el.insertBefore(this.backCtrl,this.el.firstChild)),this._initEvents()},t.prototype._initEvents=function(){for(var a=this,e=0,t=this.menusArr.length;e<t;++e)this.menusArr[e].menuItems.forEach(function(e,r){e.querySelector("a").addEventListener("click",function(e){var t=e.target.getAttribute("data-submenu"),n=e.target.innerHTML,i=a.el.querySelector('ul[data-menu="'+t+'"]');t&&i?(e.preventDefault(),a._openSubMenu(i,r,n)):(a.el.querySelector(".menu__link--current")&&classie.remove(a.el.querySelector(".menu__link--current"),"menu__link--current"),classie.add(e.target,"menu__link--current"),a.options.onItemClick(e,n))})});this.options.backCtrl&&this.backCtrl.addEventListener("click",function(){a._back()})},t.prototype._openSubMenu=function(e,t,n){if(this.isAnimating)return!1;this.isAnimating=!0,this.menusArr[this.menus.indexOf(e)].backIdx=this.current_menu,this.menusArr[this.menus.indexOf(e)].name=n,this._menuOut(t),this._menuIn(e,t)},t.prototype._back=function(){if(this.isAnimating)return!1;this.isAnimating=!0,this._menuOut();var e=this.menusArr[this.menusArr[this.current_menu].backIdx].menuEl;this._menuIn(e),this.options.breadcrumbsCtrl&&this.breadcrumbsCtrl.removeChild(this.breadcrumbsCtrl.lastElementChild)},t.prototype._menuOut=function(n){var i=this,e=this.menusArr[this.current_menu].menuEl,r=void 0===n;this.menusArr[this.current_menu].menuItems.forEach(function(e,t){e.style.WebkitAnimationDelay=e.style.animationDelay=r?parseInt(t*i.options.itemsDelayInterval)+"ms":parseInt(Math.abs(n-t)*i.options.itemsDelayInterval)+"ms"}),"r2l"===this.options.direction?classie.add(e,r?"animate-outToRight":"animate-outToLeft"):classie.add(e,r?"animate-outToLeft":"animate-outToRight")},t.prototype._menuIn=function(a,s){var u=this,m=this.menusArr[this.current_menu].menuEl,o=void 0===s,c=this.menus.indexOf(a),e=this.menusArr[c],t=(a=e.menuEl,e.menuItems),l=t.length;t.forEach(function(e,t){var n,i,r;e.style.WebkitAnimationDelay=e.style.animationDelay=o?parseInt(t*u.options.itemsDelayInterval)+"ms":parseInt(Math.abs(s-t)*u.options.itemsDelayInterval)+"ms",t===(s<=l/2||o?l-1:0)&&(n=e,i=function(){"r2l"===u.options.direction?(classie.remove(m,o?"animate-outToRight":"animate-outToLeft"),classie.remove(a,o?"animate-inFromLeft":"animate-inFromRight")):(classie.remove(m,o?"animate-outToLeft":"animate-outToRight"),classie.remove(a,o?"animate-inFromRight":"animate-inFromLeft")),classie.remove(m,"menu__level--current"),classie.add(a,"menu__level--current"),u.current_menu=c,o?0===u.current_menu&&u.options.backCtrl&&classie.add(u.backCtrl,"menu__back--hidden"):(u.options.backCtrl&&classie.remove(u.backCtrl,"menu__back--hidden"),u._addBreadcrumb(c)),u.isAnimating=!1,a.focus()},r=function(e){if(h){if(e.target!=this)return;this.removeEventListener(d,r)}i&&"function"==typeof i&&i.call()},h?n.addEventListener(d,r):r())}),"r2l"===this.options.direction?classie.add(a,o?"animate-inFromLeft":"animate-inFromRight"):classie.add(a,o?"animate-inFromRight":"animate-inFromLeft")},t.prototype._addBreadcrumb=function(i){if(!this.options.breadcrumbsCtrl)return!1;var r=document.createElement("a");r.href="#",r.innerHTML=i?this.menusArr[i].name:this.options.initialBreadcrumb,this.breadcrumbsCtrl.appendChild(r);var a=this;r.addEventListener("click",function(e){if(e.preventDefault(),!r.nextSibling||a.isAnimating)return!1;a.isAnimating=!0,a._menuOut();var t,n=a.menusArr[i].menuEl;for(a._menuIn(n);t=r.nextSibling;)a.breadcrumbsCtrl.removeChild(t)})},t.prototype._crawlCrumbs=function(e,t){0!=t[e].backIdx&&this._crawlCrumbs(t[e].backIdx,t),this._addBreadcrumb(e)},e.MLMenu=t}(window);
